---
title: "Migrating from Thanos or Prometheus to Grafana Mimir"
menuTitle: "Migrating from Thanos or Prometheus to Grafana Mimir"
description: "Learn how to migrate from Thanos or Prometheus to Grafana Mimir."
weight: 10
---

# Migrating from Thanos or Prometheus to Grafana Mimir

This document guides an operator through the process of migrating a deployment of Thanos or Prometheus to Grafana Mimir.

## Overview

Grafana Mimir stores series in TSDB blocks uploaded in an object storage bucket.
These blocks are the same as those used by Prometheus and Thanos.
Each project stores blocks in different places and uses slightly different block metadata files.

## Configuring remote write to Grafana Mimir

For configuration of remote write to Grafana Mimir, refer to [Configuring Prometheus remote write]({{< relref "../operators-guide/securing/authentication-and-authorization.md#configuring-prometheus-remote-write" >}}).

## Uploading historic blocks to the Grafana Mimir storage bucket

Prometheus stores TSDB blocks in the path specified in the `--storage.tsdb.path` flag.

To find all blocks directories in the TSDB `<STORAGE TSDB PATH>`, run the following command:

```bash
find <STORAGE TSDB PATH> -name chunks -exec dirname {} \;
```

Grafana Mimir supports multiple tenants and stores blocks with a tenant prefix.
With multi-tenancy disabled, there is a single tenant called `anonymous`.

Copy each directory output from the previous command to the Grafana Mimir object storage bucket with
your tenant prefix.

- For AWS S3, use the `aws` tool in the following command:

```bash
aws s3 cp <DIRECTORY> s3://<TENANT>/<DIRECTORY>
```

- For Google Cloud Storage (GCS), use the `gsutil` tool in the following command:

```bash
gsutil -m cp -r <DIRECTORY> gs://<TENANT>/<DIRECTORY>
```

## Block metadata

Every block has a `meta.json` metadata file used by Grafana Mimir, Prometheus, and Thanos to identify the block contents.
Each project has its own metadata conventions.

Ingesters from Mimir 2.1 and earlier added an external label into `meta.json` file to identify the tenant that owns the block.
Mimir compactor also adds special label identifying compactor-shard when split-and-merge sharding feature is enabled.

In Mimir 2.2 and later blocks no longer have a label identifying the tenant. Compactor shard label is still used.

When querying blocks, Mimir ignores all external labels and doesn't add them to the results.
During compaction Mimir will respect external labels in the block and only merge blocks with the same labels together.

Note that blocks from Prometheus do not have any external labels stored in them, only blocks from Thanos use them.

### Note about Thanos: external labels and downsampling

Thanos requires that Prometheus is configured with external labels.
When Thanos sidecar uploads blocks, it includes these external labels into `meta.json` file inside the block.
Thanos then returns these external labels when block is queried, and can also use labels for deduplication of replicated data.

Mimir doesn't include external labels in the query results.
This means that blocks that were originally created by Thanos will not include their external labels in the results when queried.

Thanos can also be configured to use labels for deduplication. After uploading such blocks into Mimir, query results will contain duplicate samples (assuming they don't use exact same timestamp).
Mimir's Compactor will however not compact such blocks together, as long as blocks have different set of external labels.

Mimir also doesn't understand Thanos "downsampling" feature, that is `Resolution` field from `meta.json` file created by Thanos is ignored by Mimir.
A notable exception is the Mimir compactor, which will not compact blocks with different resolutions together.
Blocks generated by Mimir don't set the resolution field at all.
